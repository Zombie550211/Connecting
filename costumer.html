<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Connecting</title>
  <style>

    table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  text-align: left;
  padding: 8px;
  border-bottom: 1px solid #ddd;
  white-space: nowrap;
}
th {
  cursor: pointer;
}


    html, body {
  height: 100%;
  margin: 0;
}

.container {
  display: flex;
  height: 100%;
}

nav {
  width: 200px;
  background-color: #1c2b39;
  color: white;
  padding: 10px;
}

.main-content {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
  background-color: white;
  display: flex;
  flex-direction: column;
}

.table-wrapper {
  flex-grow: 1;
  overflow: auto;
}


    .btn-eliminar {
  background-color: #add8e6; /* azul claro */
  border: none;
  color: black;
  font-size: 16px;
  padding: 4px 6px;
  border-radius: 4px;
  cursor: pointer;
}


.btn-eliminar:hover {
  background-color: #87ceeb;
}

    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: white;
      margin: 0;
      padding: 0;
      display: flex;
    }

    /* Sidebar infinita estilo Lead */
    nav {
      width: 220px;
      background: #1E2A38;
      color: white;
      padding: 20px;
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
    }

    nav h2 {
      font-size: 20px;
      font-weight: bold;
      text-align: center;
    }

    nav button {
      background: #2A3B4C;
      color: white;
      border: none;
      padding: 10px;
      text-align: left;
      font-weight: 600;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }

    nav button:hover,
    nav button.active {
      background: #00aaff;
    }

    .main-content {
      margin-left: 220px;
      flex-grow: 1;
    }

   header {
  background-color: white;
  color: #003366;

    }

    .descargar-excel {
      position: absolute;
      right: 1rem;
      top: 1rem;
      background-color: #007bff;
      color: white;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      text-decoration: none;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      padding: 1rem;
      background-color: #f2f2f2;
    }

    .filters input,
.filters select {
  padding: 8px 12px;
  font-size: 0.95rem;
  border: 1px solid #ccc;
  border-radius: 6px;
  background-color: white;
  transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

.filters input:focus,
.filters select:focus {
  outline: none;
  border-color: #007bff;
  box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.15);
}

th {
  background-color: #003366;
  color: white;
  padding: 0.75rem 0.5rem;
  text-align: left;
  font-weight: 600;
}

td {
  padding: 0.5rem 0.5rem;
  font-size: 0.95rem;
  font-weight: 400;
  border-bottom: 1px solid #ccc;
  background-color: white;
}
tbody tr:nth-child(odd) td {
  background-color: #ffffff;
}
tbody tr:nth-child(even) td {
  background-color: #f5f5f5;
}

  </style>
  
</head>
<body>
  <!-- Sidebar -->
  <nav>
    <h2>Connecting</h2>
    <button onclick="location.href='index.html'">Inicio</button>
    <button onclick="location.href='lead.html'">Lead</button>
    <button class="active">Costumer</button>
    <button onclick="location.href='#'">Reports</button>
  </nav>

  <!-- Contenido principal -->
  <div class="main-content">
    <header>
      <h1>Connecting</h1>
      <a class="descargar-excel" onclick="exportarExcel()">Descargar Excel</a>
    </header>

    <div class="filters">
      <label>Fecha desde: <input type="date" id="fecha-desde"></label>
      <label>Fecha hasta: <input type="date" id="fecha-hasta"></label>
      <label>Team:
        <select id="filtro-team">
          <option value="">Todos</option>
          <option value="Team Irania">Team Irania</option>
          <option value="Team Pleitez">Team Pleitez</option>
          <option value="Team Roberto">Team Roberto</option>
          <option value="Team Lineas">Team Lineas</option>
          <option value="Team Randal">Team Randal</option>
          <option value="Team Marisol">Team Marisol</option>
        </select>
      </label>
      <label>Agente: <select id="filtro-agente"><option value="">Todos</option></select></label>
      <label>N√∫mero: <input type="text" id="filtro-numero" placeholder="Buscar n√∫mero"></label>
      <label>Direcci√≥n: <input type="text" id="filtro-direccion" placeholder="Buscar direcci√≥n"></label>
      <label>ZIP Code: <input type="text" id="filtro-zip" placeholder="Buscar ZIP"></label>
    </div>

    <div class="table-wrapper">
      <table id="tabla-clientes">
        <thead>
          <tr>
            <th>FECHA</th>
            <th>TEAM</th>
            <th>AGENTE</th>
            <th>N√öMERO</th>
            <th>SERVICIO</th>
            <th>PUNTOS</th>
            <th>CUENTA</th>
            <th>DIRECCI√ìN</th>
            <th>ZIP CODE</th>
            <th>ACCI√ìN</th>
          </tr>
        </thead>
        <tbody></tbody> <!-- ‚úÖ tbody presente -->
      </table>
    </div>

  </div>
 <script>
  const filtroTeam = document.getElementById("filtro-team");
  const filtroAgente = document.getElementById("filtro-agente");
  const filtroNumero = document.getElementById("filtro-numero");
  const filtroDireccion = document.getElementById("filtro-direccion");
  const filtroZip = document.getElementById("filtro-zip");
  const fechaDesde = document.getElementById("fecha-desde");
  const fechaHasta = document.getElementById("fecha-hasta");
  const tabla = document.getElementById("tabla-clientes").querySelector("tbody");

  let datos = [];

  const agentesPorTeam = {
    "Team Irania": ["Irvin Cruz", "Josue Renderos", "Julissa Rubio", "Miguel Nunez", "Pamela Urrutia", "Roxana Martinez", "Estefany Amaya","Giselle Diaz"],
    "Team Pleitez": ["Diego Mejia", "Fabricio Paname√±o", "Luis Chavarria", "Mauricio Rivera", "Steven Varela", "Estefany Garcia", "Ellen Diaz"],
    "Team Roberto": ["Carlos Marroquin", "Daniela Bonilla", "Francisco Aguilar", "Ingrid Garcia", "Lisbeth Cortez", "Nelson Ceren", "Tatiana Ayala"],
    "Team Lineas": ["Jocelyn R Lineas", "Jonathan Figueroa", "Lineas-Carlos", "Lineas-Cristian R", "Lineas-Diego.O", "Lineas-Edward", "Lineas-Kenia", "Lineas-Luis G", "Lineas-Oscar R", "Lineas-Ricardo"],
    "Team Randal": ["Abigail Morales", "Alexander Montecinos", "Anderson Guzman", "Carlos Grande", "Johana Santana", "Julio Chavez", "Priscila Hernandez", "Randal Martinez"],
    "Team Marisol": ["Alessandro Romero", "Fernanda Castillo", "Katerine Gomez", "Kimberly Iglesias", "Marisol Beltran", "Paola Trejo", "Rodrigo Hernandez", "Tatiana Valdez"]
  };

  filtroTeam.addEventListener("change", () => {
    const agentes = agentesPorTeam[filtroTeam.value] || [];
    filtroAgente.innerHTML = '<option value="">Todos</option>';
    agentes.forEach(agente => {
      const option = document.createElement("option");
      option.value = agente;
      option.textContent = agente;
      filtroAgente.appendChild(option);
    });
    aplicarFiltros();
  });

  [filtroAgente, filtroNumero, filtroDireccion, filtroZip, fechaDesde, fechaHasta].forEach(filtro => {
    filtro.addEventListener("input", aplicarFiltros);
  });

  function convertirFecha(fechaStr) {
    const partes = fechaStr.split("/");
    if (partes.length === 3) {
      const [mes, dia, a√±o] = partes;
      return new Date(`${a√±o}-${mes}-${dia}`);
    }
    return new Date(fechaStr);
  }

  function esHoy(fechaStr) {
    const fecha = convertirFecha(fechaStr);
    const hoy = new Date();
    return fecha.toDateString() === hoy.toDateString();
  }

  

  function renderizarTabla(filas) {
  tabla.innerHTML = "";

  // üü® Mostrar mensaje si no hay datos
  if (filas.length === 0) {
    const row = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 10; // abarca todas las columnas
    td.textContent = "No hay datos para mostrar.";
    td.style.textAlign = "center";
    td.style.padding = "1rem";
    row.appendChild(td);
    tabla.appendChild(row);
    return;
  }

  const ordenadas = ordenarPorFechaDesc(filas);
  ordenadas.forEach(fila => {
    const tr = document.createElement("tr");

    ["FECHA", "TEAM", "AGENTE", "N√öMERO", "SERVICIO", "PUNTOS", "CUENTA", "DIRECCI√ìN", "ZIP CODE"].forEach(clave => {
      const td = document.createElement("td");
      td.textContent = fila[clave] || "";
      tr.appendChild(td);
    });

    const tdAccion = document.createElement("td");
    tdAccion.innerHTML = `<button class="btn-eliminar" onclick="eliminarLead('${fila.FECHA}', '${fila["N√öMERO"]}', '${fila.AGENTE}')">üóëÔ∏è</button>`;
    tr.appendChild(tdAccion);

    tabla.appendChild(tr);
  });
}

function aplicarFiltros() {
  const team = filtroTeam.value;
  const agente = filtroAgente.value.toLowerCase();
  const numero = filtroNumero.value.toLowerCase();
  const direccion = filtroDireccion.value.toLowerCase();
  const zip = filtroZip.value.toLowerCase();
  const desde = fechaDesde.value;
  const hasta = fechaHasta.value;

  let filtrados = datos.filter(item => {
    const fechaItem = convertirFecha(item.FECHA);
    const cumpleDesde = desde ? fechaItem >= new Date(desde) : true;
    const cumpleHasta = hasta ? fechaItem <= new Date(hasta) : true;
    const coincideTeam = !team || (agentesPorTeam[team] || []).includes(item.AGENTE);
    const coincideAgente = !agente || item.AGENTE.toLowerCase().includes(agente);
    const coincideNumero = !numero || item["N√öMERO"].toLowerCase().includes(numero);
    const coincideDireccion = !direccion || item.DIRECCI√ìN.toLowerCase().includes(direccion);
    const coincideZip = !zip || item["ZIP CODE"].toLowerCase().includes(zip);

    return cumpleDesde && cumpleHasta && coincideTeam && coincideAgente &&
           coincideNumero && coincideDireccion && coincideZip;
  });

  // Por defecto mostrar solo lo de hoy
  if (!desde && !hasta) {
    filtrados = filtrados.filter(item => esHoy(item.FECHA));
  }

  renderizarTabla(filtrados);
}

async function cargarDatos() {
    try {
      const res = await fetch("/api/leads");
      const tipo = res.headers.get("content-type");
      if (!tipo.includes("application/json")) throw new Error("Respuesta inesperada");
      datos = await res.json();
      aplicarFiltros(); // << esto s√≠ renderiza al inicio
    } catch (e) {
      console.error("Error cargando datos:", e.message);
    }
  }

  cargarDatos();
</script>


  <script> function convertirFecha(fechaStr) {
  const partes = fechaStr.split("/");
  if (partes.length === 3) {
    const [mes, dia, a√±o] = partes;  // <-- el orden correcto para tu Excel
    return new Date(`${a√±o}-${mes}-${dia}`);
  }
  return new Date(fechaStr);
}

function ordenarPorFechaDesc(arr) {
  return arr.sort((a, b) => convertirFecha(b.FECHA) - convertirFecha(a.FECHA));
}

</script>  
<script>
let ordenActual = {
  columna: null,
  ascendente: true,
};

document.querySelectorAll("#tabla-clientes thead th").forEach((th, index) => {
  th.addEventListener("click", () => {
    const clave = th.textContent.trim();
    if (!clave || clave === "ACCI√ìN") return;

    const nuevaAsc = ordenActual.columna === clave ? !ordenActual.ascendente : true;
    ordenActual = { columna: clave, ascendente: nuevaAsc };

    const datosOrdenados = [...datos].sort((a, b) => {
      const valA = (a[clave] || "").toString().toLowerCase();
      const valB = (b[clave] || "").toString().toLowerCase();
      if (!isNaN(valA) && !isNaN(valB)) {
        return nuevaAsc ? valA - valB : valB - valA;
      }
      return nuevaAsc ? valA.localeCompare(valB) : valB.localeCompare(valA);
    });

    renderizarTabla(datosOrdenados);
  });
});
</script>
<script src="costumer.js"></script>
<script src="costumer.js"></script>

</body>
</html>
