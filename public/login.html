<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Connecting | Acceso</title>
  <style>
    body {
      min-height: 100vh;
      margin: 0;
      background: linear-gradient(135deg, #22b3ec 0%, #f5f7fa 100%);
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .auth-card {
      width: 520px;
      height: 520px;
      max-width: 98vw;
      max-height: 98vh;
      border-radius: 18px;
      background: #fff;
      box-shadow: 0 8px 32px rgba(30,41,59,0.18);
      display: flex;
      overflow: hidden;
      position: relative;
      transition: box-shadow .2s;
    }
    .auth-card:hover {
      box-shadow: 0 16px 48px rgba(30,41,59,0.24);
    }
    .auth-left, .auth-right {
      flex: 1 1 0;
      padding: 36px 28px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-width: 0;
      overflow: hidden;
      transition: background .18s;
    }
    .auth-left {
      background: #fff;
      border-right: 2px solid #f0f3fa;
      align-items: center;
    }
    .auth-logo {
      width: 48px;
      height: 48px;
      margin-bottom: 10px;
      animation: fadeInLogo 1s;
    }
    @keyframes fadeInLogo {
      from { opacity:0; transform: scale(0.7);}
      to { opacity:1; transform: scale(1);}
    }
    .auth-title {
      font-size: 1.45em;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 16px;
      letter-spacing: 1px;
      text-align: center;
    }
    .auth-form {
      width: 100%;
      max-width: 210px;
      display: flex;
      flex-direction: column;
      gap: 13px;
    }
    .auth-field {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 5px;
      width: 100%;
      position: relative;
    }
    .auth-form label {
      font-weight: 500;
      color: #2d456b;
      font-size: 1em;
    }
    .auth-form input[type="text"], 
    .auth-form input[type="password"], 
    .auth-form input[type="email"] {
      padding: 9px 13px;
      font-size: 1.05em;
      border-radius: 8px;
      border: 1.5px solid #e3e8ee;
      background: #f5f7fa;
      outline: none;
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 0;
      transition: border .2s, box-shadow .2s;
      font-family: inherit;
    }
    .auth-form input:focus {
      border-color: #22b3ec;
      background: #fff;
      box-shadow: 0 2px 12px #22b3ec22;
    }
    .auth-btn {
      background: #22b3ec;
      color: #fff;
      font-size: 1.08em;
      font-weight: 700;
      padding: 10px 0;
      border: none;
      border-radius: 8px;
      margin-top: 2px;
      transition: background .17s, box-shadow .2s;
      cursor: pointer;
      box-shadow: 0 2px 8px #22b3ec22;
      width: 100%;
      letter-spacing: .5px;
    }
    .auth-btn:hover, .auth-btn:focus {
      background: #1896c8;
      box-shadow: 0 4px 12px #22b3ec55;
    }
    .auth-error, .auth-success {
      font-size: .97em;
      padding: 7px 14px;
      border-radius: 7px;
      text-align: center;
      margin-bottom: 2px;
      display: none;
      width: 100%;
      box-sizing: border-box;
      animation: fadeIn .4s;
    }
    .auth-error {
      color: #ff3b3b;
      background: #fff6f6;
      border: 1px solid #ffbdbd;
    }
    .auth-success {
      color: #169e38;
      background: #e3ffe9;
      border: 1px solid #a3f5b6;
    }
    /* Registro */
    .auth-right {
      background: #f8fafc;
      align-items: center;
    }
    .register-title {
      font-size: 1.13em;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 9px;
      text-align: center;
    }
    .register-form {
      width: 100%;
      max-width: 210px;
      display: flex;
      flex-direction: column;
      gap: 9px;
    }
    .register-field {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      width: 100%;
      gap: 4px;
      position: relative;
    }
    .register-form label {
      font-weight: 500;
      color: #2d456b;
      font-size: 1em;
    }
    .register-form input[type="text"],
    .register-form input[type="password"],
    .register-form input[type="email"] {
      padding: 9px 13px;
      font-size: 1.05em;
      border-radius: 8px;
      border: 1.5px solid #e3e8ee;
      background: #fff;
      outline: none;
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 0;
      transition: border .2s, box-shadow .2s;
      font-family: inherit;
    }
    .register-form input:focus {
      border-color: #22b3ec;
      background: #f5f7fa;
      box-shadow: 0 2px 12px #22b3ec22;
    }
    .register-btn {
      background: #22b3ec;
      color: #fff;
      font-size: 1.08em;
      font-weight: 700;
      padding: 10px 0;
      border: none;
      border-radius: 8px;
      margin-top: 2px;
      transition: background .17s, box-shadow .2s;
      cursor: pointer;
      box-shadow: 0 2px 8px #22b3ec22;
      width: 100%;
      letter-spacing: .5px;
    }
    .register-btn:hover, .register-btn:focus {
      background: #1896c8;
      box-shadow: 0 4px 12px #22b3ec55;
    }
    @media (max-width: 640px) {
      .auth-card {
        flex-direction: column;
        width: 97vw;
        height: auto;
        min-height: 0;
        border-radius: 12px;
      }
      .auth-left, .auth-right {
        border: none;
        min-width: 0;
        padding: 22px 5vw;
      }
      .auth-title, .register-title { font-size: 1em; }
      .auth-form, .register-form { max-width: 100%; }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="auth-card">
    <!-- LOGIN -->
    <div class="auth-left">
      <div class="auth-logo">
        <img src="logo connecting.png" alt="Logo Connecting" style="width:100%;height:100%;">
      </div>
      <div class="auth-title">Connecting</div>
      <form class="auth-form" id="loginForm" autocomplete="off">
        <div class="auth-field">
          <label for="user">Usuario</label>
          <input type="text" id="user" name="user" autocomplete="username" required autofocus>
        </div>
        <div class="auth-field">
          <label for="pass">Contraseña</label>
          <input type="password" id="pass" name="pass" autocomplete="current-password" required>
        </div>
        <div class="auth-error" id="loginError"></div>
        <button class="auth-btn" type="submit">Ingresar</button>
      </form>
    </div>
    <!-- REGISTRO -->
    <div class="auth-right">
      <div class="register-title">Crear nuevo usuario</div>
      <form class="register-form" id="registerForm" autocomplete="off">
        <div class="register-field">
          <label for="nombre">Nombre</label>
          <input type="text" id="nombre" name="nombre" required placeholder="Nombre">
        </div>
        <div class="register-field">
          <label for="apellido">Apellido</label>
          <input type="text" id="apellido" name="apellido" required placeholder="Apellido">
        </div>
        <div class="register-field">
          <label for="newuser">Usuario</label>
          <input type="text" id="newuser" name="newuser" required minlength="3" maxlength="30" pattern="^[a-zA-Z0-9_.-]{3,30}$" placeholder="Nombre de usuario">
        </div>
        <div class="register-field">
          <label for="newemail">Correo electrónico</label>
          <input type="email" id="newemail" name="newemail" required placeholder="usuario@dominio.com">
        </div>
        <div class="register-field">
          <label for="newpass">Contraseña</label>
          <input type="password" id="newpass" name="newpass" required minlength="6" maxlength="32" placeholder="Contraseña">
        </div>
        <div class="register-field">
          <label for="newpass2">Confirmar Contraseña</label>
          <input type="password" id="newpass2" name="newpass2" required minlength="6" maxlength="32" placeholder="Repite la contraseña">
        </div>
        <div class="auth-success" id="registerSuccess"></div>
        <div class="auth-error" id="registerError"></div>
        <button class="register-btn" type="submit">Crear Usuario</button>
      </form>
    </div>
  </div>
  <script>
    // LOGIN
    const loginForm = document.getElementById('loginForm');
    const loginErrorDiv = document.getElementById('loginError');
    loginForm.onsubmit = async function(e) {
      e.preventDefault();
      loginErrorDiv.style.display = "none";
      const user = loginForm.user.value.trim();
      const pass = loginForm.pass.value.trim();
      if (!user || !pass) {
        loginErrorDiv.textContent = "Por favor, llena ambos campos.";
        loginErrorDiv.style.display = "block";
        return;
      }
      try {
        const resp = await fetch('/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ user, pass })
        });
        const data = await resp.json();
        if (data.success) {
          window.location.href = "lead.html";
        } else {
          loginErrorDiv.textContent = "Usuario o contraseña incorrectos.";
          loginErrorDiv.style.display = "block";
        }
      } catch (err) {
        loginErrorDiv.textContent = "Error de conexión con el servidor.";
        loginErrorDiv.style.display = "block";
      }
    };

    // REGISTRO USUARIO
    const registerForm = document.getElementById('registerForm');
    const registerErrorDiv = document.getElementById('registerError');
    const registerSuccessDiv = document.getElementById('registerSuccess');
    registerForm.onsubmit = async function(e) {
      e.preventDefault();
      registerErrorDiv.style.display = "none";
      registerSuccessDiv.style.display = "none";
      const nombre = registerForm.nombre.value.trim();
      const apellido = registerForm.apellido.value.trim();
      const usuario = registerForm.newuser.value.trim();
      const correo = registerForm.newemail.value.trim();
      const pass = registerForm.newpass.value;
      const pass2 = registerForm.newpass2.value;
      if (!nombre || !apellido || !usuario || !correo || !pass || !pass2) {
        registerErrorDiv.textContent = "Por favor, completa todos los campos.";
        registerErrorDiv.style.display = "block";
        return;
      }
      if (pass !== pass2) {
        registerErrorDiv.textContent = "Las contraseñas no coinciden.";
        registerErrorDiv.style.display = "block";
        return;
      }
      try {
        const resp = await fetch('/api/users/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nombre, apellido, usuario, correo, pass })
        });
        const data = await resp.json();
        if (data.success) {
          registerSuccessDiv.textContent = "Usuario creado correctamente.";
          registerSuccessDiv.style.display = "block";
          registerForm.reset();
        } else {
          registerErrorDiv.textContent = data.error || "Error al crear usuario.";
          registerErrorDiv.style.display = "block";
        }
      } catch (err) {
        registerErrorDiv.textContent = "Error de conexión con el servidor.";
        registerErrorDiv.style.display = "block";
      }
    };
  </script>
</body>
</html>